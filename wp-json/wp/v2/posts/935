{"id":935,"date":"2020-01-25T13:35:34","date_gmt":"2020-01-25T12:35:34","guid":{"rendered":"https:\/\/machinelearningspace.com\/?p=935"},"modified":"2020-03-06T09:17:05","modified_gmt":"2020-03-06T08:17:05","slug":"sentiment-analysis-tensorflow","status":"publish","type":"post","link":"https:\/\/machinelearningspace.com\/sentiment-analysis-tensorflow\/","title":{"rendered":"Sentiment Analysis Using Keras Embedding Layer in TensorFlow 2.0"},"content":{"rendered":"\n<p>Learn How to Solve Sentiment Analysis Problem With Keras Embedding Layer and Tensorflow<\/p>\n\n\n\n<figure class=\"wp-block-image size-full\"><img decoding=\"async\" loading=\"lazy\" width=\"2560\" height=\"1554\" src=\"https:\/\/machinelearningspace.com\/wp-content\/uploads\/2020\/01\/HeadImg-1-scaled.jpg\" alt=\"NLP\" class=\"wp-image-987\" srcset=\"https:\/\/machinelearningspace.com\/wp-content\/uploads\/2020\/01\/HeadImg-1-scaled.jpg 2560w, https:\/\/machinelearningspace.com\/wp-content\/uploads\/2020\/01\/HeadImg-1-300x182.jpg 300w, https:\/\/machinelearningspace.com\/wp-content\/uploads\/2020\/01\/HeadImg-1-1024x622.jpg 1024w, https:\/\/machinelearningspace.com\/wp-content\/uploads\/2020\/01\/HeadImg-1-768x466.jpg 768w, https:\/\/machinelearningspace.com\/wp-content\/uploads\/2020\/01\/HeadImg-1-1536x933.jpg 1536w, https:\/\/machinelearningspace.com\/wp-content\/uploads\/2020\/01\/HeadImg-1-2048x1243.jpg 2048w, https:\/\/machinelearningspace.com\/wp-content\/uploads\/2020\/01\/HeadImg-1-494x300.jpg 494w\" sizes=\"(max-width: 2560px) 100vw, 2560px\" \/><\/figure>\n\n\n\n<h2>Introduction<\/h2>\n\n\n\n<p>Text classification, one of the fundamental tasks in Natural Language Processing, is a process of assigning predefined categories data to&nbsp;textual documents such as reviews, articles, tweets, blogs, etc. <\/p>\n\n\n\n<p>One of the special cases of text classification is sentiment analysis.<\/p>\n\n\n\n<p>The sentiment analysis is a process of gaining an understanding of the people&#8217;s or consumers&#8217; emotions or opinions about a product, service, person, or idea.  By understanding consumers&#8217; opinions, producers can enhance the quality of their products or services to meet the needs of their customers. <\/p>\n\n\n\n<p>Sentiment can be classified into binary classification (positive or negative), and multi-class classification (3 or more classes, e.g., negative, neutral and positive).<\/p>\n\n\n\n<p>In this tutorial, we are going to learn how to perform a simple sentiment analysis using TensorFlow by leveraging Keras Embedding layer. For the purpose of this tutorial, we&#8217;re going to use a case of Amazon&#8217;s reviews. <\/p>\n\n\n\n<p>This is the list what we are going to do in this tutorial:<\/p>\n\n\n\n<ul><li>Load the Amazon reviews data, then take randomly 20% of the data as our dataset. From this 20%, we&#8217;ll be dividing it again randomly to training data (70%) and validation data ( 30%). <\/li><li>Perform preprocessing including removing punctuation,  numbers, and single characters; and converting the upper cases to the lower cases,  so that the model can learn it easily.<\/li><li>Convert all text in corpus into sequences of words by using the Keras Tokenizer API.<\/li><li>Create and train a Deep Learning model to classify the sentiments using Keras Embedding layer.<\/li><li>Validate the model.<\/li><\/ul>\n\n\n\n<p>Here is a straightforward guide to implementing it. Let&#8217;s get started!. <\/p>\n\n\n\n<h2>Data preparation<\/h2>\n\n\n\n<h3>Step1: Download the amazon reviews data from Kaggle<\/h3>\n\n\n\n<p>For the purpose of this tutorial, we&#8217;re going to use the Kaggle&#8217;s dataset of amazon reviews that can be downloaded from this <a href=\"https:\/\/www.kaggle.com\/bittlingmayer\/amazonreviews\">link.<\/a> If you want to work with google collab you can upload this dataset to your Google drive. <\/p>\n\n\n\n<p>First of all, verify the installed TensorFlow 2.x in your colab notebook. If it exists, select it, otherwise upgrade TensorFlow.<\/p>\n\n\n\n<pre class=\"EnlighterJSRAW\" data-enlighter-language=\"python\" data-enlighter-theme=\"atomic\" data-enlighter-highlight=\"\" data-enlighter-linenumbers=\"\" data-enlighter-lineoffset=\"\" data-enlighter-title=\"\" data-enlighter-group=\"\">try:\n    %tensorflow_version 2.x\nexcept:    \n    !pip install --upgrade tensorflow<\/pre>\n\n\n\n<p>Then, mount your Google drive with the following code:<\/p>\n\n\n\n<pre class=\"EnlighterJSRAW\" data-enlighter-language=\"python\" data-enlighter-theme=\"atomic\" data-enlighter-highlight=\"\" data-enlighter-linenumbers=\"\" data-enlighter-lineoffset=\"\" data-enlighter-title=\"\" data-enlighter-group=\"\">from google.colab import drive\ndrive.mount('\/content\/drive')<\/pre>\n\n\n\n<p>Run the code and your output will be something like this: <\/p>\n\n\n\n<div class=\"wp-block-image\"><figure class=\"aligncenter size-full\"><img decoding=\"async\" loading=\"lazy\" width=\"912\" height=\"183\" src=\"https:\/\/machinelearningspace.com\/wp-content\/uploads\/2020\/02\/drive.png\" alt=\"\" class=\"wp-image-1193\" srcset=\"https:\/\/machinelearningspace.com\/wp-content\/uploads\/2020\/02\/drive.png 912w, https:\/\/machinelearningspace.com\/wp-content\/uploads\/2020\/02\/drive-300x60.png 300w, https:\/\/machinelearningspace.com\/wp-content\/uploads\/2020\/02\/drive-768x154.png 768w, https:\/\/machinelearningspace.com\/wp-content\/uploads\/2020\/02\/drive-550x110.png 550w\" sizes=\"(max-width: 912px) 100vw, 912px\" \/><\/figure><\/div>\n\n\n\n<p>Click on the link provided as shown in the figure above, then authorize the connection, you will be given a code, copy and paste it to the box &#8220;<code>Enter your authorization code:<\/code>&#8220;, then press Enter. Now, you are normally in the Google drive directory.<\/p>\n\n\n\n<p>Here is my Google drive, (just for example). I uploaded the file <code>amazonreviews.zip<\/code> to the NLP folder in my Google drive.<\/p>\n\n\n\n<div class=\"wp-block-image\"><figure class=\"aligncenter size-full\"><img decoding=\"async\" loading=\"lazy\" width=\"442\" height=\"300\" src=\"https:\/\/machinelearningspace.com\/wp-content\/uploads\/2020\/01\/drive2.png\" alt=\"Sentiment Analysis: google drive\" class=\"wp-image-1057\" srcset=\"https:\/\/machinelearningspace.com\/wp-content\/uploads\/2020\/01\/drive2.png 442w, https:\/\/machinelearningspace.com\/wp-content\/uploads\/2020\/01\/drive2-300x204.png 300w\" sizes=\"(max-width: 442px) 100vw, 442px\" \/><\/figure><\/div>\n\n\n\n<p>Point to the path where your  <code>amazonreviews.zip<\/code> file is located. Mine is like in the following:<\/p>\n\n\n\n<pre class=\"EnlighterJSRAW\" data-enlighter-language=\"python\" data-enlighter-theme=\"atomic\" data-enlighter-highlight=\"\" data-enlighter-linenumbers=\"\" data-enlighter-lineoffset=\"\" data-enlighter-title=\"\" data-enlighter-group=\"\">%cd drive\/My\\ Drive\/NLP<\/pre>\n\n\n\n<p>Unzip the <code>amazonreviews.zip<\/code> file and decompress it.<\/p>\n\n\n\n<pre class=\"EnlighterJSRAW\" data-enlighter-language=\"python\" data-enlighter-theme=\"atomic\" data-enlighter-highlight=\"\" data-enlighter-linenumbers=\"\" data-enlighter-lineoffset=\"\" data-enlighter-title=\"\" data-enlighter-group=\"\">!unzip amazonreviews.zip<\/pre>\n\n\n\n<p>The <code>amazonreviews.zip<\/code> file contains two compressed files, <code>train.ft.txt.bz2<\/code> and  <code>test.ft.txt.bz2<\/code>. <\/p>\n\n\n\n<p>In this tutorial, we&#8217;re going to use only the <code>train.ft.txt.bz2<\/code> file.  So just  decompress this file using the following command, then you will have a <code>.txt<\/code> file, that is<code>train.ft.txt<\/code>. <\/p>\n\n\n\n<pre class=\"EnlighterJSRAW\" data-enlighter-language=\"python\" data-enlighter-theme=\"atomic\" data-enlighter-highlight=\"\" data-enlighter-linenumbers=\"\" data-enlighter-lineoffset=\"\" data-enlighter-title=\"\" data-enlighter-group=\"\">!bzip2 -d train.ft.txt.bz2<\/pre>\n\n\n\n<p>Now, we&#8217;re going to open the <code>train.ft.txt<\/code> file. To do so, use the following code:<\/p>\n\n\n\n<pre class=\"EnlighterJSRAW\" data-enlighter-language=\"python\" data-enlighter-theme=\"atomic\" data-enlighter-highlight=\"\" data-enlighter-linenumbers=\"\" data-enlighter-lineoffset=\"\" data-enlighter-title=\"\" data-enlighter-group=\"\">with open('train.ft.txt', 'r') as file:\n    lines = file.readlines()<\/pre>\n\n\n\n<p>First, let&#8217;s take a look at the contents of the <code>train.ft.txt<\/code> file.<\/p>\n\n\n\n<div class=\"wp-block-image\"><figure class=\"aligncenter size-full\"><img decoding=\"async\" loading=\"lazy\" width=\"1414\" height=\"623\" src=\"https:\/\/machinelearningspace.com\/wp-content\/uploads\/2020\/01\/print_txt0-1.png\" alt=\"Sentiment Analysis: Amazon Reviews data\" class=\"wp-image-1061\" srcset=\"https:\/\/machinelearningspace.com\/wp-content\/uploads\/2020\/01\/print_txt0-1.png 1414w, https:\/\/machinelearningspace.com\/wp-content\/uploads\/2020\/01\/print_txt0-1-300x132.png 300w, https:\/\/machinelearningspace.com\/wp-content\/uploads\/2020\/01\/print_txt0-1-1024x451.png 1024w, https:\/\/machinelearningspace.com\/wp-content\/uploads\/2020\/01\/print_txt0-1-768x338.png 768w, https:\/\/machinelearningspace.com\/wp-content\/uploads\/2020\/01\/print_txt0-1-550x242.png 550w\" sizes=\"(max-width: 1414px) 100vw, 1414px\" \/><\/figure><\/div>\n\n\n\n<p>As you can observe from the above figure, the beginnings of the lines are the labels followed by the reviews. The file contains only two review labels, <code>_label__2<\/code> and <code>__label_1<\/code> for the <em>positive <\/em>and <em>negative<\/em>, respectively. <\/p>\n\n\n\n<p>So far, we&#8217;re doing good. Let&#8217;s go ahead.<\/p>\n\n\n\n<h3>Step2: Data Preprocessing<\/h3>\n\n\n\n<p>Since our data source is data with <code>.txt<\/code> format,  I prefer to convert it to a Pandas&#8217; data frame.  So, the first step of this data preparation is to convert the <code>.txt<\/code> data to the Pandas&#8217; data frame format. <\/p>\n\n\n\n<h4>Converting Data to Pandas Data Frame<\/h4>\n\n\n\n<p>To do so, I will start it by importing Pandas and creating a Pandas&#8217; data frame <code>DF_text_data<\/code> as follows:<\/p>\n\n\n\n<pre class=\"EnlighterJSRAW\" data-enlighter-language=\"python\" data-enlighter-theme=\"atomic\" data-enlighter-highlight=\"\" data-enlighter-linenumbers=\"false\" data-enlighter-lineoffset=\"\" data-enlighter-title=\"\" data-enlighter-group=\"\"># create a dataframe\nimport pandas as pd\nDF_text_data = pd.DataFrame()\n<\/pre>\n\n\n\n<p>Now, we&#8217;re going to loop over the <code>lines<\/code> using the variable <code>line<\/code>. Then, we&#8217;ll separate the labels and the reviews from the <code>line<\/code> and store them to the Pandas&#8217; data frame <code>DF_text_data<\/code> with different columns.<\/p>\n\n\n\n<p>Anytime we loop over the <code>lines<\/code>,  we convert text labels to numerical labels. Since this review is a binary case problem, i.e., <em>negative <\/em>and <em>positive <\/em>reviews, so we can easily convert these labels by replacing all the labels  <code>__label__2<\/code> to <code>1s<\/code> and all the labels  <code>__label__1<\/code> to <code>0s<\/code>. <\/p>\n\n\n\n<p>Here is the code for doing this:<\/p>\n\n\n\n<pre class=\"EnlighterJSRAW\" data-enlighter-language=\"python\" data-enlighter-theme=\"atomic\" data-enlighter-highlight=\"\" data-enlighter-linenumbers=\"\" data-enlighter-lineoffset=\"\" data-enlighter-title=\"\" data-enlighter-group=\"\">texts=[]\nlabels=[]\nfor line in lines:\n    line=line.split()\n    labels.append(1) if line[0] ==\"__label__2\" else labels.append(0)\n    texts.append(\" \".join(line[1:]))\n\nDF_text_data['reviews'] = texts\nDF_text_data['labels'] = labels<\/pre>\n\n\n\n<p>If we print <code>DF_text_data<\/code>, you will see something like in the following figure. The data consists of 3 columns, they are indexes, reviews and labels.<\/p>\n\n\n\n<div class=\"wp-block-image\"><figure class=\"aligncenter size-large is-resized\"><img decoding=\"async\" loading=\"lazy\" src=\"https:\/\/machinelearningspace.com\/wp-content\/uploads\/2020\/01\/print_txt3.png\" alt=\"Sentiment Analysis: Amazon reviews\" class=\"wp-image-1064\" width=\"465\" height=\"355\" srcset=\"https:\/\/machinelearningspace.com\/wp-content\/uploads\/2020\/01\/print_txt3.png 769w, https:\/\/machinelearningspace.com\/wp-content\/uploads\/2020\/01\/print_txt3-300x229.png 300w, https:\/\/machinelearningspace.com\/wp-content\/uploads\/2020\/01\/print_txt3-392x300.png 392w\" sizes=\"(max-width: 465px) 100vw, 465px\" \/><\/figure><\/div>\n\n\n\n<p>As you can see, the index is started from 0 to 3.599.999, meaning this dataset contains 3.6M reviews and labels. This is a big dataset, by the way. If you have a good computer resource, you could just use them all, otherwise, we&#8217;ll be using a small part of it, let&#8217;s say 2 percent of it. To do so, check this code: <\/p>\n\n\n\n<pre class=\"EnlighterJSRAW\" data-enlighter-language=\"python\" data-enlighter-theme=\"atomic\" data-enlighter-highlight=\"\" data-enlighter-linenumbers=\"\" data-enlighter-lineoffset=\"\" data-enlighter-title=\"\" data-enlighter-group=\"\">from sklearn import model_selection\n\n_, X_data,_, y_data = \\\n    model_selection.train_test_split(DF_text_data['reviews'], \n                                     DF_text_data['labels'], test_size=0.02)\n<\/pre>\n\n\n\n<p>The <code>X_data<\/code> now only contains 72K reviews and labels.<\/p>\n\n\n\n<h3>Data cleaning<\/h3>\n\n\n\n<p>Before we can go deeper into analyzing, we need to do data cleaning, including removing punctuation, numbers, and single characters; and converting the upper cases to the lower cases, so that the model can learn the data easily.  <\/p>\n\n\n\n<p>The following is the function for this purpose:<\/p>\n\n\n\n<pre class=\"EnlighterJSRAW\" data-enlighter-language=\"python\" data-enlighter-theme=\"atomic\" data-enlighter-highlight=\"\" data-enlighter-linenumbers=\"\" data-enlighter-lineoffset=\"\" data-enlighter-title=\"\" data-enlighter-group=\"\">def preprocess(in_text):\n    # If we have html tags, remove them by this way:\n    #out_text = remove_tags(in_text)\n\n    # Remove punctuations and numbers\n    out_text = re.sub('[^a-zA-Z]', ' ', in_text)\n    # Convert upper case to lower case\n    out_text=\"\".join(list(map(lambda x:x.lower(),out_text)))\n    # Remove single character\n    out_text = re.sub(r\"\\s+[a-zA-Z]\\s+\", ' ', out_text)\n    return out_text<\/pre>\n\n\n\n<p>Now, perform the preprocessing by calling the <code>preprocess <\/code>function.<\/p>\n\n\n\n<pre class=\"EnlighterJSRAW\" data-enlighter-language=\"python\" data-enlighter-theme=\"atomic\" data-enlighter-highlight=\"\" data-enlighter-linenumbers=\"\" data-enlighter-lineoffset=\"\" data-enlighter-title=\"\" data-enlighter-group=\"\">#Performing preprocessing\nimport re\n\ntext_data=[]\nfor review in list(X_data):\n    text_data.append(preprocess(review))<\/pre>\n\n\n\n<p>Create a new data frame to store a small part of the data that has been performed preprocessing.<\/p>\n\n\n\n<pre class=\"EnlighterJSRAW\" data-enlighter-language=\"python\" data-enlighter-theme=\"atomic\" data-enlighter-highlight=\"\" data-enlighter-linenumbers=\"\" data-enlighter-lineoffset=\"\" data-enlighter-title=\"\" data-enlighter-group=\"\">DF_text= pd.DataFrame()\nDF_text['reviews'] = text_data\nDF_text['labels'] = list(y_data)<\/pre>\n\n\n\n<p>Now, we plot the data distribution for both classes. From the plot figure, we can see that the distribution of the data is almost the same portion for both negative and positive sentiments.<\/p>\n\n\n\n<pre class=\"EnlighterJSRAW\" data-enlighter-language=\"python\" data-enlighter-theme=\"atomic\" data-enlighter-highlight=\"\" data-enlighter-linenumbers=\"\" data-enlighter-lineoffset=\"\" data-enlighter-title=\"\" data-enlighter-group=\"\">#Plot data distribution\nimport seaborn as sns\nsns.countplot(x='labels', data=DF_text)\n\n\"\"\"\nIf you use Anaconda with PyCharm uncomment these lines to show the figure.\n\"\"\"\n#import matplot.pyplot as as plt\n#plt.show()<\/pre>\n\n\n\n<div class=\"wp-block-image\"><figure class=\"aligncenter size-large is-resized\"><img decoding=\"async\" loading=\"lazy\" src=\"https:\/\/machinelearningspace.com\/wp-content\/uploads\/2020\/01\/data_dist.png\" alt=\"Sentiment Analysis: Plot data \" class=\"wp-image-1097\" width=\"472\" height=\"232\" srcset=\"https:\/\/machinelearningspace.com\/wp-content\/uploads\/2020\/01\/data_dist.png 783w, https:\/\/machinelearningspace.com\/wp-content\/uploads\/2020\/01\/data_dist-300x148.png 300w, https:\/\/machinelearningspace.com\/wp-content\/uploads\/2020\/01\/data_dist-768x378.png 768w, https:\/\/machinelearningspace.com\/wp-content\/uploads\/2020\/01\/data_dist-550x270.png 550w\" sizes=\"(max-width: 472px) 100vw, 472px\" \/><\/figure><\/div>\n\n\n\n<p>Now we&#8217;re going to divide our dataset into 70% as training and 30% as testing data. <\/p>\n\n\n\n<pre class=\"EnlighterJSRAW\" data-enlighter-language=\"python\" data-enlighter-theme=\"atomic\" data-enlighter-highlight=\"\" data-enlighter-linenumbers=\"\" data-enlighter-lineoffset=\"\" data-enlighter-title=\"\" data-enlighter-group=\"\">X_train, X_test, y_train, y_test = \\\n    model_selection.train_test_split(DF_text['reviews'], \n                                     DF_text['labels'], test_size=0.30)\n\n<\/pre>\n\n\n\n<p>Convert them to the list array.<\/p>\n\n\n\n<pre class=\"EnlighterJSRAW\" data-enlighter-language=\"python\" data-enlighter-theme=\"atomic\" data-enlighter-highlight=\"\" data-enlighter-linenumbers=\"\" data-enlighter-lineoffset=\"\" data-enlighter-title=\"\" data-enlighter-group=\"\">import numpy as np\nX_train=np.array(X_train.values.tolist())\nX_test=np.array(X_test.values.tolist())\ny_train=np.array(y_train.values.tolist())\ny_test=np.array(y_test.values.tolist())<\/pre>\n\n\n\n<h2>Word Embeddings<\/h2>\n\n\n\n<p>In order to train our data, Deep learning model requires the numerical data as its input. Since we&#8217;re working on text classification, we need to translate our text data into numerical vectors. To do so, we&#8217;re going to use a method called word embeddings. This method encodes every word into an n-dimensional dense vector in which similar words will have similar encoding. <\/p>\n\n\n\n<p>For this purpose, we\u2019re going to use a Keras Embedding layer.  Embedding layer can be used to learn both custom word embeddings and predefined word embeddings like GloVe and Word2Vec.   <\/p>\n\n\n\n<p>In this NLP tutorial, we&#8217;re going to use a Keras embedding layer to train our own custom word embedding model.  The layer is initialized with random weights and is defined as the first hidden layer of a network.   <\/p>\n\n\n\n<p>The Embedding layer has 3 important arguments:<\/p>\n\n\n\n<ul><li><strong>input_dim<\/strong>: Size of the vocabulary in the text data. <\/li><li><strong>output_dim<\/strong>: Size of the vector space in which words will be embedded. This is a parameter that can be experimented for having a better performance. (ex: 32, 100, &#8230;)<\/li><li><strong>input_length<\/strong>: Length of input sequences<\/li><\/ul>\n\n\n\n<h3>Tokenizer<\/h3>\n\n\n\n<p>Before the data text can be fed to the Keras embedding layer, it must be encoded first, so that each word can be represented by a unique integer as required by the Embedding layer. To do this, Keras also provides a Tokenizer API that allows us to vectorize a text corpus into a sequence of integers.  <\/p>\n\n\n\n<p>The following is the code to do the tokenization.  First, we create a Keras tokenizer object. Then, with this object, we can call the <code>fit_on_texts<\/code>  function to fit the Keras tokenizer to the dataset.   <\/p>\n\n\n\n<pre class=\"EnlighterJSRAW\" data-enlighter-language=\"python\" data-enlighter-theme=\"atomic\" data-enlighter-highlight=\"\" data-enlighter-linenumbers=\"\" data-enlighter-lineoffset=\"\" data-enlighter-title=\"\" data-enlighter-group=\"\">from keras_preprocessing.text import Tokenizer\n\ntokenizer = Tokenizer()\ntokenizer.fit_on_texts(X_train)\nword_index=tokenizer.word_index\nvocab_size = len(word_index)+1\nprint(vocab_size)<\/pre>\n\n\n\n<p>After fitting the tokenizer to the dataset, now we&#8217;re ready to convert our text to sequences by passing our data text to <code>texts_to_sequences<\/code> function.<\/p>\n\n\n\n<p>This function tokenizes the input corpus into tokens of words where each of the word token is associated with a unique integer value.  <\/p>\n\n\n\n<p>We do it for both training and testing data. <\/p>\n\n\n\n<pre class=\"EnlighterJSRAW\" data-enlighter-language=\"python\" data-enlighter-theme=\"atomic\" data-enlighter-highlight=\"\" data-enlighter-linenumbers=\"\" data-enlighter-lineoffset=\"\" data-enlighter-title=\"\" data-enlighter-group=\"\">X_train = tokenizer.texts_to_sequences(X_train)\nX_test = tokenizer.texts_to_sequences(X_test)<\/pre>\n\n\n\n<p>Finally, we add padding to make all the vectors to have the same length <code>maxlen<\/code>.<\/p>\n\n\n\n<pre class=\"EnlighterJSRAW\" data-enlighter-language=\"python\" data-enlighter-theme=\"atomic\" data-enlighter-highlight=\"\" data-enlighter-linenumbers=\"\" data-enlighter-lineoffset=\"\" data-enlighter-title=\"\" data-enlighter-group=\"\">from tensorflow.keras.preprocessing.sequence import pad_sequences\nfrom tensorflow.keras.utils import to_categorical\n\nmaxlen = 100\n\nX_train_pad = pad_sequences(X_train, padding='post', maxlen=maxlen)\nX_test_pad = pad_sequences(X_test, padding='post', maxlen=maxlen)<\/pre>\n\n\n\n<p>Now, the data is ready to be feed to the model.   <\/p>\n\n\n\n<h2>Create a Model<\/h2>\n\n\n\n<p>We are now ready to create the NN model. For this tutorial, we use a simple network, you can try to use a deeper network, or with different configuration such as using LSTM layer, and perform a comparison.<\/p>\n\n\n\n<p>We create a sequential model with the embedding layer is the first layer, then followed by a GRU layer with dropout=0.2 and recurrent_dropout=0.2.  and the last layer is a dense layer with the sigmoid activation function. We use sigmoid because we only have one output. <\/p>\n\n\n\n<pre class=\"EnlighterJSRAW\" data-enlighter-language=\"python\" data-enlighter-theme=\"atomic\" data-enlighter-highlight=\"\" data-enlighter-linenumbers=\"\" data-enlighter-lineoffset=\"\" data-enlighter-title=\"\" data-enlighter-group=\"\">from tensorflow.keras.layers import Flatten, GRU, Dense, Flatten, Embedding\nfrom tensorflow.keras.models import Sequential\n\nmodel = Sequential()\nmodel.add(Embedding(vocab_size, 20, input_length=maxlen))\nmodel.add(GRU(units=32,dropout=0.2, recurrent_dropout=0.2))\nmodel.add(Dense(1, activation='sigmoid'))<\/pre>\n\n\n\n<h2>Compile the Model<\/h2>\n\n\n\n<p>To compile the model, we use <code>Adam <\/code>optimizer with <code>binary_crossentropy<\/code>.<\/p>\n\n\n\n<pre class=\"EnlighterJSRAW\" data-enlighter-language=\"python\" data-enlighter-theme=\"atomic\" data-enlighter-highlight=\"\" data-enlighter-linenumbers=\"\" data-enlighter-lineoffset=\"\" data-enlighter-title=\"\" data-enlighter-group=\"\">model.compile(optimizer='adam', loss='binary_crossentropy', metrics=['acc'])\nprint(model.summary())<\/pre>\n\n\n\n<div class=\"wp-block-image\"><figure class=\"aligncenter size-full\"><img decoding=\"async\" loading=\"lazy\" width=\"917\" height=\"359\" src=\"https:\/\/machinelearningspace.com\/wp-content\/uploads\/2020\/02\/summary.png\" alt=\"Sentiment Analysis: Model Word embeddings\" class=\"wp-image-1119\" srcset=\"https:\/\/machinelearningspace.com\/wp-content\/uploads\/2020\/02\/summary.png 917w, https:\/\/machinelearningspace.com\/wp-content\/uploads\/2020\/02\/summary-300x117.png 300w, https:\/\/machinelearningspace.com\/wp-content\/uploads\/2020\/02\/summary-768x301.png 768w, https:\/\/machinelearningspace.com\/wp-content\/uploads\/2020\/02\/summary-550x215.png 550w\" sizes=\"(max-width: 917px) 100vw, 917px\" \/><\/figure><\/div>\n\n\n\n<h2>Train the Model<\/h2>\n\n\n\n<p>Now, it&#8217;s time to train the model. <\/p>\n\n\n\n<p>This code below is used to train the model. We validate the model while training process.<\/p>\n\n\n\n<pre class=\"EnlighterJSRAW\" data-enlighter-language=\"python\" data-enlighter-theme=\"atomic\" data-enlighter-highlight=\"\" data-enlighter-linenumbers=\"\" data-enlighter-lineoffset=\"\" data-enlighter-title=\"\" data-enlighter-group=\"\">model.fit(X_train_pad, y_train, batch_size=128, epochs=10, verbose=1, validation_data=(X_test_pad, y_test))<\/pre>\n\n\n\n<p>After 10 epochs, the model achieves 86.66% of accuracy after epoch 10. Not bad.<\/p>\n\n\n\n<div class=\"wp-block-image\"><figure class=\"aligncenter size-full\"><img decoding=\"async\" loading=\"lazy\" width=\"1459\" height=\"504\" src=\"https:\/\/machinelearningspace.com\/wp-content\/uploads\/2020\/02\/accuracy.png\" alt=\"Training Validation Sentiment Analysis\" class=\"wp-image-1117\" srcset=\"https:\/\/machinelearningspace.com\/wp-content\/uploads\/2020\/02\/accuracy.png 1459w, https:\/\/machinelearningspace.com\/wp-content\/uploads\/2020\/02\/accuracy-300x104.png 300w, https:\/\/machinelearningspace.com\/wp-content\/uploads\/2020\/02\/accuracy-1024x354.png 1024w, https:\/\/machinelearningspace.com\/wp-content\/uploads\/2020\/02\/accuracy-768x265.png 768w, https:\/\/machinelearningspace.com\/wp-content\/uploads\/2020\/02\/accuracy-550x190.png 550w\" sizes=\"(max-width: 1459px) 100vw, 1459px\" \/><\/figure><\/div>\n\n\n\n<h2>Conclusion<\/h2>\n\n\n\n<p>In this article, we&#8217;ve built a simple model of sentiment analysis using custom word embeddings by leveraging the Keras API in TensorFlow 2.0.<\/p>\n\n\n\n<p>Here are some remarks:<\/p>\n\n\n\n<ul><li>To do text classification, we need to do some data preprocessing,  including removing punctuation, numbers, and single character and converting upper cases to lower cases, so that the computer can easily understand and enhance the accuracy rate.   <\/li><li>A Deep learning model requires numerical data as its input. Therefore we need to convert our text data into numerical vectors.  To do so, we use the word embeddings method.<\/li><li>Word embeddings are a way of representing words that can encode corpus text into numerical vector spaces in which similar words will have similar encoding.   <\/li><li>It is considered the best available representation of words in NLP. <\/li><\/ul>\n\n\n\n<h2>Next&#8230;<\/h2>\n\n\n\n<p>To explore further, in the next tutorial, we&#8217;re going to use two popular pre-trained word embeddings, GloVe and Word2Vec. So, see you in the next tutorial.<\/p>\n","protected":false},"excerpt":{"rendered":"<p>The sentiment analysis is a process of gaining an understanding of the people&#8217;s or consumers&#8217; emotions or opinions about a product, service, person, or idea.  By understanding consumers&#8217; opinions, producers can enhance the quality of their products or services to meet the needs of their customers. <\/p>\n","protected":false},"author":2,"featured_media":987,"comment_status":"open","ping_status":"open","sticky":false,"template":"","format":"standard","meta":{"_mi_skip_tracking":false},"categories":[2,4,5,3],"tags":[11,51,54,53,50,7,27,52],"_links":{"self":[{"href":"https:\/\/machinelearningspace.com\/wp-json\/wp\/v2\/posts\/935"}],"collection":[{"href":"https:\/\/machinelearningspace.com\/wp-json\/wp\/v2\/posts"}],"about":[{"href":"https:\/\/machinelearningspace.com\/wp-json\/wp\/v2\/types\/post"}],"author":[{"embeddable":true,"href":"https:\/\/machinelearningspace.com\/wp-json\/wp\/v2\/users\/2"}],"replies":[{"embeddable":true,"href":"https:\/\/machinelearningspace.com\/wp-json\/wp\/v2\/comments?post=935"}],"version-history":[{"count":5,"href":"https:\/\/machinelearningspace.com\/wp-json\/wp\/v2\/posts\/935\/revisions"}],"predecessor-version":[{"id":1319,"href":"https:\/\/machinelearningspace.com\/wp-json\/wp\/v2\/posts\/935\/revisions\/1319"}],"wp:featuredmedia":[{"embeddable":true,"href":"https:\/\/machinelearningspace.com\/wp-json\/wp\/v2\/media\/987"}],"wp:attachment":[{"href":"https:\/\/machinelearningspace.com\/wp-json\/wp\/v2\/media?parent=935"}],"wp:term":[{"taxonomy":"category","embeddable":true,"href":"https:\/\/machinelearningspace.com\/wp-json\/wp\/v2\/categories?post=935"},{"taxonomy":"post_tag","embeddable":true,"href":"https:\/\/machinelearningspace.com\/wp-json\/wp\/v2\/tags?post=935"}],"curies":[{"name":"wp","href":"https:\/\/api.w.org\/{rel}","templated":true}]}}